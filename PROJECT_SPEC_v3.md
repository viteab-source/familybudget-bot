# FamilyBudget Bot ‚Äî –¢–ó –∏ —á–µ–∫-–ª–∏—Å—Ç v3

## 0. –ö–∞–∫ —ç—Ç–∏–º —Ñ–∞–π–ª–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è

–≠—Ç–æ **–∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –ò–ò-–ø–æ–º–æ—â–Ω–∏–∫–∞** –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞.

* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –ª–µ–∂–∏—Ç –≤ GitHub-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:
  `https://github.com/viteab-source/familybudget-bot.git`
* –¢–µ–∫—É—â–∞—è –æ—Å–Ω–æ–≤–Ω–∞—è —Ä–∞–±–æ—á–∞—è –≤–µ—Ç–∫–∞: `feature/smart-categories-aiadd` (–µ—Å–ª–∏ —è–≤–Ω–æ –Ω–µ —Å–∫–∞–∑–∞–Ω–æ –¥—Ä—É–≥–æ–µ).
* –õ—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è **–¥–µ–ª–∞–µ–º –º–∞–ª–µ–Ω—å–∫–∏–º–∏ —à–∞–≥–∞–º–∏** –∏ **–∫–∞–∂–¥—ã–π —à–∞–≥ —Ñ–∏–∫—Å–∏—Ä—É–µ–º –≤ git** (`git add` ‚Üí `git commit` ‚Üí `git push`).

–ï—Å–ª–∏ —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω –≤ ‚Äú–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ‚Äù/–ø—Ä–æ–µ–∫—Ç –ò–ò, –æ–Ω –¥–æ–ª–∂–µ–Ω:

1. –ü–æ–Ω–∏–º–∞—Ç—å, —á—Ç–æ —ç—Ç–æ —Ç–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç —Å–µ–º–µ–π–Ω–æ–≥–æ –±—é–¥–∂–µ—Ç–∞.
2. –°–º–æ—Ç—Ä–µ—Ç—å —Ñ–∞–π–ª—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∏ –ø—Ä–∞–≤–∏—Ç—å –∏—Ö –ø–æ –∑–∞–ø—Ä–æ—Å—É.
3. –û–±—ä—è—Å–Ω—è—Ç—å –≤—Å—ë –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏, **–∫–∞–∫ –¥–ª—è —à–∫–æ–ª—å–Ω–∏–∫–∞**.

---

## 1. –ò–¥–µ—è –ø—Ä–æ–¥—É–∫—Ç–∞

**–ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ**

FamilyBudget Bot ‚Äî —Ç–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç + backend-API –¥–ª—è —É—á—ë—Ç–∞ —Å–µ–º–µ–π–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤/–¥–æ—Ö–æ–¥–æ–≤:

* –∫–∞–∂–¥—ã–π —á–µ–ª–æ–≤–µ–∫ –ø–∏—à–µ—Ç –±–æ—Ç—É:

  * —Ç–µ–∫—Å—Ç–æ–º: `‚Äú–º–∞–≥–Ω–∏—Ç 500 –ø—Ä–æ–¥—É–∫—Ç—ã‚Äù`;
  * –≥–æ–ª–æ—Å–æ–º: –≥–æ–≤–æ—Ä–∏—Ç —Ñ—Ä–∞–∑—É, –±–æ—Ç —Å–∞–º —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç –∏ —Ä–∞–∑–Ω–æ—Å–∏—Ç;
* –ò–ò (YandexGPT) —Ä–∞–∑–±–∏—Ä–∞–µ—Ç —Ç–µ–∫—Å—Ç, –Ω–∞—Ö–æ–¥–∏—Ç:

  * —Å—É–º–º—É,
  * –¥–∞—Ç—É,
  * –∫–∞—Ç–µ–≥–æ—Ä–∏—é,
  * –º–∞–≥–∞–∑–∏–Ω (merchant),
* –±–æ—Ç –≤–µ–¥—ë—Ç **–æ–±—â—É—é —Å–µ–º—å—é**: –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª—é–¥–µ–π ‚Üí –æ–¥–Ω–∞ ‚Äú—Å–µ–º—å—è‚Äù (household);
* –µ—Å—Ç—å **–æ—Ç—á—ë—Ç—ã**, **–±—é–¥–∂–µ—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º**, **–Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è**, **—É–º–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏** –∏ –ª–æ–≥ –æ—à–∏–±–æ–∫ –ò–ò.

–¶–µ–ª—å: —á—Ç–æ–±—ã –æ–±—ã—á–Ω—ã–π —á–µ–ª–æ–≤–µ–∫ –º–æ–≥ –ø—Ä–æ—Å—Ç–æ –ø–∏—Å–∞—Ç—å ‚Äú—Ç–∞–∫—Å–∏ –¥–æ–º–æ–π 500 –≤—á–µ—Ä–∞‚Äù, –∞ –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ –±–æ—Ç —Å–¥–µ–ª–∞–ª —Å–∞–º.

---

## 2. –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –°—Ç–µ–∫

* Backend: **FastAPI** + **SQLAlchemy** + **PostgreSQL**
* –ú–∏–≥—Ä–∞—Ü–∏–∏: **Alembic**
* Bot: **aiogram 3**
* AI:

  * YandexGPT ‚Äî —Ä–∞–∑–±–æ—Ä —Ç–µ–∫—Å—Ç–∞ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é;
  * Yandex STT ‚Äî —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –≥–æ–ª–æ—Å–∞.
* –õ–æ–≥–∏–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π: —Å–≤–æ–∏ —Ñ—É–Ω–∫—Ü–∏–∏ + `difflib` –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ—Ö–æ–∂–∏—Ö –Ω–∞–∑–≤–∞–Ω–∏–π.

### –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (–≤–µ—Ä—Ö–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å)

* `backend/`

  * `app/main.py` ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ FastAPI.
  * `app/models.py` ‚Äî SQLAlchemy-–º–æ–¥–µ–ª–∏.
  * `app/schemas.py` ‚Äî Pydantic-—Å—Ö–µ–º—ã (—á—Ç–æ –ø—Ä–∏–ª–µ—Ç–∞–µ—Ç/—É–ª–µ—Ç–∞–µ—Ç –ø–æ API).
  * `app/api/` ‚Äî —Ä–æ—É—Ç–µ—Ä—ã:

    * `transactions.py` ‚Äî –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ä–∞—Å—Ö–æ–¥–∞–º–∏/–¥–æ—Ö–æ–¥–∞–º–∏.
    * `categories.py` ‚Äî –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —Ñ–∏–¥–±–µ–∫, overrides.
    * `report.py` ‚Äî –æ—Ç—á—ë—Ç—ã (summary/balance/members/shops).
    * `reminders.py` ‚Äî –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è.
    * `household.py`, `user.py` ‚Äî —Å–µ–º—å—è, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏.
  * `app/utils.py` ‚Äî –æ–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã:

    * —Ä–∞–±–æ—Ç–∞ —Å –±—é–¥–∂–µ—Ç–∞–º–∏ (`attach_budget_info_to_tx`),
    * –ø–∞—Ä—Å–∏–Ω–≥ merchant (`extract_merchant_from_text`),
    * **–ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π** –ø–æ `difflib` –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∏–º–µ–Ω–∏.
  * `app/ai.py` ‚Äî —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ YandexGPT.
  * `app/maintenance/normalize_categories.py` ‚Äî —Å–∫—Ä–∏–ø—Ç —á–∏—Å—Ç–∫–∏ –¥—É–±–ª–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–π.
* `bot/`

  * `bot.py` ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –±–æ—Ç–∞.
  * `handlers/`:

    * `transactions.py` ‚Äî –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã –ø–æ —Ä–∞—Å—Ö–æ–¥–∞–º/–¥–æ—Ö–æ–¥–∞–º, AI-–¥–æ–±–∞–≤–ª–µ–Ω–∏—é –∏ –≥–æ–ª–æ—Å—É.
    * `reports.py` ‚Äî –∫–æ–º–∞–Ω–¥—ã –æ—Ç—á—ë—Ç–æ–≤.
    * `reminders.py`, `start.py`, `household.py` –∏ —Ç.–ø.
  * `services/api_client.py` ‚Äî —Ç–æ–Ω–∫–∏–π –∫–ª–∏–µ–Ω—Ç –∫ backend API.
  * `config.py` ‚Äî `API_BASE_URL`, `YANDEX_API_KEY` –∏ —Ç.–ø.
* –í –∫–æ—Ä–Ω–µ:

  * `.env.example` / `.env` ‚Äî —Ç–æ–∫–µ–Ω—ã, —Å—Ç—Ä–æ–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.
  * `README.md` ‚Äî –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ.
  * `PROJECT_SPEC_v3.md` (—ç—Ç–æ—Ç —Ñ–∞–π–ª –º–æ–∂–Ω–æ —Ç—É–¥–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å).

---

## 3. –î–∞–Ω–Ω—ã–µ (–º–æ–¥–µ–ª–∏) ‚Äî –µ—Å–ª–∏ –∫–æ—Ä–æ—Ç–∫–æ

*–í–∞–∂–Ω–æ: —Ç–æ—á–Ω—ã–µ –ø–æ–ª—è —Å–º–æ—Ç—Ä–µ—Ç—å –≤ `backend/app/models.py` –∏ `schemas.py`. –ó–¥–µ—Å—å –æ–±–∑–æ—Ä –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è.*

* `User` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–æ—Ç–∞ (telegram_id, name –∏ —Ç.–¥.).
* `Household` ‚Äî —Å–µ–º—å—è (name, currency, privacy_mode).
* `HouseholdMember` ‚Äî —Å–≤—è–∑—å User ‚Üî Household + —Ä–æ–ª—å (owner, member).
* `Transaction`

  * `amount`, `currency`, `description`,
  * `category` (—Å—Ç—Ä–æ–∫–æ–π, —á–µ–ª–æ–≤–µ–∫–æ-—á–∏—Ç–∞–µ–º–æ–µ),
  * `category_id` (—Å—Å—ã–ª–∫–∞ –Ω–∞ `Category`),
  * `merchant` (–º–∞–≥–∞–∑–∏–Ω),
  * `kind` (`expense` / `income`),
  * `date`, `created_at`,
  * —Å–ª—É–∂–µ–±–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –ò–ò (–≤ —Å—Ö–µ–º–∞—Ö): `candidate_categories`, `raw_category`, `suggested_category`, `needs_confirmation`.
* `Category`

  * `household_id`, `name`, `parent_id`, `sort_order`.
* `CategoryBudget`

  * –ª–∏–º–∏—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –Ω–∞ –º–µ—Å—è—Ü.
* `CategoryOverride`

  * —Ö—Ä–∞–Ω–∏—Ç **–ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è**:

    * `normalized_pattern` (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –ø–æ–∫—É–ø–∫–∏),
    * `category` (–∫–∞–∫—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø—Ä–∏–º–µ–Ω—è—Ç—å),
    * `counter` (—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–ª).
* `TransactionCategoryFeedback`

  * –ª–æ–≥ —Ñ–∏–¥–±–µ–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

    * `transaction_id`,
    * `user_selected_category`,
    * `ai_category`,
    * `raw_text`,
    * `created_at` –∏ —Ç.–¥.
* `Reminder` ‚Äî –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–∞—Ö.
* `HouseholdInvite` ‚Äî –∏–Ω–≤–∞–π—Ç-–∫–æ–¥—ã –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ —Å–µ–º—å–µ.

---

## 4. –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∏—á–∏, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ **—Å–¥–µ–ª–∞–Ω—ã**

### 4.1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ —Å–µ–º—å—è

* `/me` ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:

  * –∫—Ç–æ —è,
  * –≤ –∫–∞–∫–æ–π —Å–µ–º—å–µ,
  * —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.
* `/household` ‚Äî –∏–Ω—Ñ–æ –æ —Å–µ–º—å–µ.
* `/household/invite` + `/household/join` ‚Äî –∏–Ω–≤–∞–π—Ç—ã.
* `/user/set-name`, `/household/rename` ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –∏ –Ω–∞–∑–≤–∞–Ω–∏—è —Å–µ–º—å–∏.

### 4.2. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

Backend:

* `POST /api/transactions` ‚Äî —Å–æ–∑–¥–∞—Ç—å —Ä–∞—Å—Ö–æ–¥/–¥–æ—Ö–æ–¥ –≤—Ä—É—á–Ω—É—é:

  * —É—á–∏—Ç—ã–≤–∞–µ—Ç `category`:

    * –∏—â–µ—Ç —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ —Å–µ–º—å–µ;
    * –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî —á–µ—Ä–µ–∑ `difflib` –∏—â–µ—Ç **–ø–æ—Ö–æ–∂—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é** (–ª–æ–≤–∏–º ‚Äú—Ç–∞–∫—Å**–∏**—Å–∏‚Äù ‚Üí ‚Äú–¢–∞–∫—Å–∏‚Äù);
    * –µ—Å–ª–∏ —Ç–æ–∂–µ –Ω–µ—Ç ‚Äî —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é;
  * —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `category_id` + `category` (—Å—Ç—Ä–æ–∫–æ–π),
  * –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç `merchant` —á–µ—Ä–µ–∑ `extract_merchant_from_text`,
  * –ø—Ä–∏–∫—Ä–µ–ø–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –±—é–¥–∂–µ—Ç–∞ —á–µ—Ä–µ–∑ `attach_budget_info_to_tx`.
* `GET /api/transactions` ‚Äî —Å–ø–∏—Å–æ–∫ –ø–æ –¥–∞—Ç–µ, —Å —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ `kind`.
* `GET /api/transactions/last` ‚Äî –ø–æ—Å–ª–µ–¥–Ω—è—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
* `POST /api/transactions/delete-last` ‚Äî —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é.
* `POST /api/transactions/edit-last` ‚Äî –∏–∑–º–µ–Ω–∏—Ç—å —Å—É–º–º—É/–æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π.
* `POST /api/transactions/set-category-last` ‚Äî —Å–º–µ–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —É –ø–æ—Å–ª–µ–¥–Ω–µ–π:

  * —Å–Ω–æ–≤–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–æ–≥–∏–∫—É ‚Äú–ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ + —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π‚Äù.
* `POST /api/transactions/parse-and-create` ‚Äî **–≥–ª–∞–≤–Ω–∞—è AI-—Ç–æ—á–∫–∞**:

  * –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–µ–∫—Å—Ç,
  * –≤—ã–∑—ã–≤–∞–µ—Ç `parse_text_to_transaction` (YandexGPT),
  * –ø—Ä–∏–º–µ–Ω—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ `CategoryOverride` (–µ—Å–ª–∏ –µ—Å—Ç—å —á–∞—Å—Ç—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω),
  * –ø—Ä–∏–≤–æ–¥–∏—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∫ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–º—É –≤–∏–¥—É,
  * —Å–æ–∑–¥–∞—ë—Ç `Transaction`,
  * –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `candidate_categories` (—Ç–æ–ø-3 –æ—Ç –ò–ò) –≤–º–µ—Å—Ç–µ —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π.
* `POST /api/transactions/suggest-categories`

  * –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å—É–º–º—É/–≤–∞–ª—é—Ç—É + —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π,
  * —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–ª—å–∫–æ –ø–æ —Ç–µ–º, —á—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –µ—Å—Ç—å –≤ —Å–µ–º—å–µ,
  * –µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ—Ç ‚Äî —Å–æ–∑–¥–∞—ë—Ç/–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ—Å–Ω–æ–≤–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ò–ò.
* `GET /api/transactions/export/csv`

  * –≤—ã–≥—Ä—É–∑–∫–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤ –≤ CSV –∑–∞ N –¥–Ω–µ–π.

Bot:

* `/add` ‚Äî —Ä—É—á–Ω–æ–π –≤–≤–æ–¥ —Ä–∞—Å—Ö–æ–¥–∞ (—Å—É–º–º–∞ ‚Üí –æ–ø–∏—Å–∞–Ω–∏–µ ‚Üí –∫–∞—Ç–µ–≥–æ—Ä–∏—è).

  * —Ç–µ–ø–µ—Ä—å —É—á–∏—Ç—ã–≤–∞–µ—Ç **–∞–≤—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—é –∫–∞—Ç–µ–≥–æ—Ä–∏–∏**:

    * –µ—Å–ª–∏ –±–µ–∫–µ–Ω–¥ –ø–æ–ø—Ä–∞–≤–∏–ª –∫—Ä–∏–≤–æ–µ –∏–º—è (‚Äú—Ç–∞–∫—Å–∏—Å–∏‚Äù ‚Üí ‚Äú–¢–∞–∫—Å–∏‚Äù), –±–æ—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç:

      * –æ—Å—Ç–∞–≤–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ,
      * –∏–ª–∏ –≤—Å—ë-—Ç–∞–∫–∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ –≤–≤—ë–ª.
* `/income` ‚Äî —Ä—É—á–Ω–æ–π –¥–æ—Ö–æ–¥.
* `/aiadd` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç –ò–ò:

  * –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –Ω–∞ `parse-and-create`,
  * –≤—ã–≤–æ–¥–∏—Ç —á–µ–∫,
  * –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç inline-–∫–Ω–æ–ø–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:

    * —Ç–µ–∫—É—â–∞—è,
    * –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã –ò–ò,
    * ‚Äú–î—Ä—É–≥–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è‚Äù.
* **–û–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç –±–µ–∑ /–∫–æ–º–∞–Ω–¥—ã**:

  * —Ç–æ–∂–µ –∏–¥—ë—Ç —á–µ—Ä–µ–∑ `parse-and-create` —Å —Ç–µ–º –∂–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–π.
* `/last`, `/delete_last`, `/edit_last` ‚Äî —Ä–∞–±–æ—Ç–∞ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π.

### 4.3. –ì–æ–ª–æ—Å + STT

* –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `@router.message(F.voice)`:

  * —Å–∫–∞—á–∏–≤–∞–µ—Ç –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ,
  * –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–∞–π–ª –≤ Yandex STT,
  * –ø–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—Å—Ç,
  * –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç,
  * –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ –≤ `parse-and-create`,
  * —Å–æ–∑–¥–∞—ë—Ç —Ä–∞—Å—Ö–æ–¥ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

### 4.4. –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —á–∏—Å—Ç–∫–∞

* –ë–∞–∑–æ–≤—ã–µ CRUD-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π —É–∂–µ –µ—Å—Ç—å (—Å–º. `categories.py`).
* –õ–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞ –ø–æ—Ö–æ–∂–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π (`difflib.SequenceMatcher`).
* –°–∫—Ä–∏–ø—Ç `backend/app/maintenance/normalize_categories.py`:

  * –Ω–∞—Ö–æ–¥–∏—Ç –¥—É–±–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –æ—Ç–ª–∏—á–∞—é—â–∏–µ—Å—è —Ç–æ–ª—å–∫–æ —Ä–µ–≥–∏—Å—Ç—Ä–æ–º –∏ –ø—Ä–æ–±–µ–ª–∞–º–∏,
  * –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –≤—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –±—é–¥–∂–µ—Ç—ã –Ω–∞ ‚Äú–≥–ª–∞–≤–Ω—É—é‚Äù –∫–∞—Ç–µ–≥–æ—Ä–∏—é,
  * —É–¥–∞–ª—è–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã.
* –î–æ–±–∞–≤–ª–µ–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç `/api/categories/feedback` (–Ω–∞ –±–µ–∫–µ–Ω–¥–µ) + –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
  `log_category_feedback` –≤ –±–æ—Ç–µ:

  * –ª–æ–≥–∏—Ä—É–µ—Ç –≤—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∫–∞–∫—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –æ–Ω –≤ –∏—Ç–æ–≥–µ –≤—ã–±—Ä–∞–ª).

### 4.5. –û—Ç—á—ë—Ç—ã

* `GET /api/report/summary`

  * –≤—Ö–æ–¥: `days`, `telegram_id`, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ `user_id`,
  * —Å—á–∏—Ç–∞–µ—Ç —Å—É–º–º—É —Ä–∞—Å—Ö–æ–¥–æ–≤ –∑–∞ –ø–µ—Ä–∏–æ–¥,
  * –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–∞–∑—Ä–µ–∑ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º.
* `GET /api/report/balance`

  * —Ä–∞—Å—Ö–æ–¥—ã/–¥–æ—Ö–æ–¥—ã/–∏—Ç–æ–≥ (`net`) –∑–∞ –ø–µ—Ä–∏–æ–¥,
  * —Ç–æ–∂–µ –º–æ–∂–Ω–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ `user_id`.
* `GET /api/report/members`

  * —Å–∫–æ–ª—å–∫–æ –ø–æ—Ç—Ä–∞—Ç–∏–ª –∫–∞–∂–¥—ã–π —É—á–∞—Å—Ç–Ω–∏–∫ —Å–µ–º—å–∏.
* `GET /api/report/shops`

  * –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –º–∞–≥–∞–∑–∏–Ω–∞–º (`merchant`),
  * –µ—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ ‚Äî –≤—ã—Ç—è–≥–∏–≤–∞–µ—Ç –º–∞–≥–∞–∑–∏–Ω –∏–∑ `description` –∏–ª–∏ –¥–∞–∂–µ –∏–∑ `category`.

–ù–∞ —Å—Ç–æ—Ä–æ–Ω–µ –±–æ—Ç–∞ —É–∂–µ –µ—Å—Ç—å –±–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –≤—ã–∑–æ–≤–∞ —ç—Ç–∏—Ö –æ—Ç—á—ë—Ç–æ–≤ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–≤–æ–¥–∞.

---

## 5. –ß—Ç–æ –µ—â—ë –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ (–¥–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞)

### 5.1. –£–º–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –æ–±—É—á–µ–Ω–∏–µ –ò–ò

1. **–î–æ–¥–µ–ª–∞—Ç—å –ª–æ–≥ —Ñ–∏–¥–±–µ–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:**

   * —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö, –≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–µ–Ω—è–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é:

     * –∫–Ω–æ–ø–∫–∏ –ø–æ—Å–ª–µ AI-–¥–æ–±–∞–≤–ª–µ–Ω–∏—è,
     * `/setcat_‚Ä¶`,
     * —Ä—É—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ,
   * –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `log_category_feedback(...)`.
   * –Ω–∞ –±–µ–∫–µ–Ω–¥–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `/categories/feedback`:

     * —Å–æ–∑–¥–∞—ë—Ç `TransactionCategoryFeedback`,
     * –∞–∫–∫—É—Ä–∞—Ç–Ω–æ –ª–æ–≥–∏—Ä—É–µ—Ç –∏ –Ω–µ –ø–∞–¥–∞–µ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö.

2. **–£—Ç–æ—á–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É CategoryOverride:**

   * –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å **–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑** –ø–æ–¥—Ä—è–¥ –≤—ã–±–∏—Ä–∞–µ—Ç –æ–¥–Ω—É –∏ —Ç—É –∂–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é
     –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤–æ–≥–æ —Ç–µ–∫—Å—Ç–∞, —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å `counter` –∏ –ø—Ä–∏ –ø–æ—Ä–æ–≥–µ (—É–∂–µ –µ—Å—Ç—å `counter >= 2`):

     * –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å override **–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** –≤ `parse-and-create`,
     * –ø–æ–¥–Ω–∏–º–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–∑ override –Ω–∞ –ø–µ—Ä–≤–æ–µ –º–µ—Å—Ç–æ –≤ `candidate_categories`.

3. **–ü–æ–¥—É–º–∞—Ç—å –ø—Ä–æ ‚Äú–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ –º–∞–≥–∞–∑–∏–Ω–∞–º‚Äù:**

   * –ø—Ä–∏–º–µ—Ä: –≤—Å–µ ‚Äú–ú–∞–≥–Ω–∏—Ç‚Äù ‚Üí –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äú–ü—Ä–æ–¥—É–∫—Ç—ã‚Äù,
   * —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—á–∫–∞ –∏–ª–∏ —á–∞—Å—Ç—å overrides.

### 5.2. –û—Ç—á—ë—Ç—ã 2.0

1. –§–∏–ª—å—Ç—Ä—ã –≤ –æ—Ç—á—ë—Ç–∞—Ö:

   * –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (–Ω–∞ –±–µ–∫–µ —É–∂–µ —á–∞—Å—Ç–∏—á–Ω–æ –µ—Å—Ç—å, –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –¥–æ–≤–µ—Å—Ç–∏),
   * –ø–æ –º–∞–≥–∞–∑–∏–Ω–∞–º (–¥–ª—è `/report/shops`),
   * –ø–µ—Ä–µ—Ç–∞—â–∏—Ç—å —ç—Ç–∏ —Ñ–∏–ª—å—Ç—Ä—ã –≤ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/report_cat –ü—Ä–æ–¥—É–∫—Ç—ã`).

2. –ö—Ä–∞—Å–∏–≤—ã–π –≤—ã–≤–æ–¥:

   * –≤ –±–æ—Ç–µ ‚Äú—Ç–æ–ø-3 –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ / –º–∞–≥–∞–∑–∏–Ω—ã‚Äù –∑–∞ –ø–µ—Ä–∏–æ–¥,
   * –∫–æ—Ä–æ—Ç–∫–∏–µ —Å–æ–≤–µ—Ç—ã: ‚Äú—Å—é–¥–∞ —É—Ö–æ–¥–∏—Ç –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ‚Äù –∏ —Ç.–ø.

### 5.3. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∏ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏

1. –î–æ–¥–µ–ª–∞—Ç—å –±–æ—Ç-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π.
2. –ü—Ä–æ–¥—É–º–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –≤–æ—Ä–∫–µ—Ä/–∫—Ä–æ–Ω, –∫–æ—Ç–æ—Ä—ã–π:

   * —Ä–∞–∑ –≤ N –º–∏–Ω—É—Ç/—á–∞—Å–æ–≤ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è,
   * —à–ª—ë—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) —Å–æ–∑–¥–∞—ë—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–æ —à–∞–±–ª–æ–Ω—É.

### 5.4. –ß–µ–∫–∏ –∏ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å—ã (–ø–æ–∑–∂–µ)

1. –°–º. –∏–¥–µ–∏ –≤ —Å—Ç–∞—Ä–æ–º –¢–ó (`Receipt`, `ReceiptItem`).
2. –í–æ–∑–º–æ–∂–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏:

   * –§–ù–° / –û–§–î –ø–æ QR,
   * –∏–º–ø–æ—Ä—Ç –∏–∑ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤ (WB/Ozon),
   * –ø–∞—Ä—Å–∏–Ω–≥ PDF/XLS.

---

## 6. –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã ‚Äú–∫–∞–∫ –¥–ª—è —à–∫–æ–ª—å–Ω–∏–∫–∞‚Äù

–û—á–µ–Ω—å –≤–∞–∂–Ω–æ: –ò–ò-–ø–æ–º–æ—â–Ω–∏–∫ **–Ω–µ –¥–æ–ª–∂–µ–Ω –ø—ã—Ç–∞—Ç—å—Å—è —Ä–µ—à–∏—Ç—å –≤—Å—ë –∑–∞ —Ä–∞–∑**. –û–¥–Ω–∞ –∏—Ç–µ—Ä–∞—Ü–∏—è = –æ–¥–∏–Ω –º–∞–ª–µ–Ω—å–∫–∏–π —à–∞–≥.

### 6.1. –û–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –ò–ò

1. **–í—Å–µ–≥–¥–∞ –æ–±—â–∞–π—Å—è –ø–æ-—Ä—É—Å—Å–∫–∏.**

2. –û–±—ä—è—Å–Ω—è–π –∫–∞–∂–¥—ã–π —à–∞–≥ –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏: ‚Äú—Å–Ω–∞—á–∞–ª–∞ —Å–¥–µ–ª–∞–µ–º –ê, –ø–æ—Ç–æ–º –ë‚Äù.

3. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—Ä–∏–¥—É–º—ã–≤–∞–π —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–æ–≤.
   –ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –ø–æ–∫–∞–∑–∞–Ω —è–≤–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º –≤ —á–∞—Ç–µ ‚Äî **–ø–æ–ø—Ä–æ—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏—Å–ª–∞—Ç—å –µ–≥–æ**.

4. –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞:

   * –ª–∏–±–æ –ø–æ–∫–∞–∑—ã–≤–∞–π **–ø–æ–ª–Ω—ã–π —Ñ–∞–π–ª —Ü–µ–ª–∏–∫–æ–º**,
   * –ª–∏–±–æ –æ—á–µ–Ω—å —á—ë—Ç–∫–∏–π diff (–ø–æ–Ω—è—Ç–Ω—ã–π –Ω–æ–≤–∏—á–∫—É).

5. –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —à–∞–≥–∞:

   * –¥–∞–≤–∞–π –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –±–ª–æ–∫–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä:

   ```bash
   git status
   git add backend/app/api/transactions.py
   git commit -m "backend: explain what changed"
   git push
   ```

6. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ —á—Ç–æ-—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

   * —è–≤–Ω–æ –Ω–∞–ø–∏—à–∏, –∫–∞–∫–æ–π –∑–∞–ø—Ä–æ—Å –æ—Ç–∫—Ä—ã—Ç—å –≤ Swagger,
   * –∫–∞–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç—É–¥–∞ –ø–æ—Å—Ç–∞–≤–∏—Ç—å,
   * –∏ —á—Ç–æ –¥–æ–ª–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å—Å—è (–ø—Ä–∏–º–µ—Ä JSON-–æ—Ç–≤–µ—Ç–∞).

7. –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ –±–æ–ª—å—à–∞—è ‚Äî **–¥–µ–ª–∏ –Ω–∞ —á–∞—Å—Ç–∏**:

   * –ß–∞—Å—Ç—å 1: –æ–±–Ω–æ–≤–ª—è–µ–º –º–æ–¥–µ–ª–∏.
   * –ß–∞—Å—Ç—å 2: –æ–±–Ω–æ–≤–ª—è–µ–º API.
   * –ß–∞—Å—Ç—å 3: –æ–±–Ω–æ–≤–ª—è–µ–º –±–æ—Ç–∞.
   * –ß–∞—Å—Ç—å 4: —Ä—É—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ —Ç–µ—Å—Ç—ã.

8. –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ ‚Äî –ª—É—á—à–µ **—Å–¥–µ–ª–∞—Ç—å —Ä–∞–∑—É–º–Ω–æ–µ –¥–æ–ø—É—â–µ–Ω–∏–µ –∏ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ –µ–≥–æ –æ–ø–∏—Å–∞—Ç—å**, —á–µ–º –∑–∞–≤–∏—Å–Ω—É—Ç—å.

### 6.2. –¢–∏–ø–æ–≤–æ–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã –Ω–∞–¥ –∑–∞–¥–∞—á–µ–π

–î–ª—è –ª—é–±–æ–π –Ω–æ–≤–æ–π —Ñ–∏—á–∏:

1. **–ü–æ–Ω—è—Ç—å –∑–∞–¥–∞—á—É.**

   * –ö–æ—Ä–æ—Ç–∫–æ –ø–µ—Ä–µ—Å–∫–∞–∑–∞—Ç—å —Å–≤–æ–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, —á—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å.

2. **–ù–∞–π—Ç–∏ –Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã.**

   * –ü–æ–ø—Ä–æ—Å–∏—Ç—å –ø–æ–∫–∞–∑–∞—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä:

     * `backend/app/api/transactions.py`
     * `backend/app/schemas.py`
     * `bot/handlers/transactions.py`

3. **–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è.**

   * –°–Ω–∞—á–∞–ª–∞ –æ–ø–∏—Å–∞—Ç—å –ª–æ–≥–∏–∫—É —Å–ª–æ–≤–∞–º–∏.
   * –ü–æ—Ç–æ–º –ø—Ä–∏—Å–ª–∞—Ç—å –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –∫–æ–¥.

4. **–ü–æ–ø—Ä–æ—Å–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**

   * –≤—Å—Ç–∞–≤–∏—Ç—å –∫–æ–¥ –≤ —Ñ–∞–π–ª—ã,
   * –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

     ```bash
     git status
     python -m backend.app.maintenance.normalize_categories   # –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
     uvicorn backend.app.main:app --reload   # –µ—Å–ª–∏ –Ω—É–∂–µ–Ω –±–µ–∫–µ–Ω–¥
     python bot/bot.py                        # –µ—Å–ª–∏ –Ω—É–∂–µ–Ω –±–æ—Ç
     ```

5. **–ü—Ä–æ–≤–µ—Ä–∫–∞.**

   * –ü–æ–¥—Å–∫–∞–∑–∞—Ç—å, –∫–∞–∫–æ–π endpoint –Ω–∞–∂–∞—Ç—å –≤ Swagger –∏–ª–∏ —á—Ç–æ –Ω–∞–ø–∏—Å–∞—Ç—å –±–æ—Ç—É.
   * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç—ã –≤–º–µ—Å—Ç–µ.

6. **–§–∏–∫—Å–∞—Ü–∏—è –≤ git.**

   * –ö–æ–º–∞–Ω–¥–∞:

     ```bash
     git status
     git add <—Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤>
     git commit -m "<–∫—Ä–∞—Ç–∫–æ–µ –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ>"
     git push
     ```

---

## 7. –ß–µ–∫-–ª–∏—Å—Ç: —á—Ç–æ —É–∂–µ –≥–æ—Ç–æ–≤–æ –∏ —á—Ç–æ –≤ —Ä–∞–±–æ—Ç–µ

### 7.1. –ì–æ—Ç–æ–≤–æ ‚úÖ

* ‚úÖ –ë–∞–∑–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ backend + bot + Postgres.
* ‚úÖ –ú–æ–¥–µ–ª–∏ User/Household/Transaction/Category/Reminder/... —Å–æ–∑–¥–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç.
* ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ–º—å–∏ –ø–æ `telegram_id` (/me, /household).
* ‚úÖ –†—É—á–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (`/add`, `/income`) + backend `POST /transactions`.
* ‚úÖ AI-–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ (`/aiadd`, plain text, –≥–æ–ª–æ—Å):

  * —Ä–∞–∑–±–æ—Ä —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ YandexGPT,
  * `parse-and-create` —Å–æ–∑–¥–∞—ë—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é,
  * –±–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π.
* ‚úÖ –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è ‚Üí Yandex STT ‚Üí –ò–ò ‚Üí —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è.
* ‚úÖ –°–º–µ–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —É –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ + –ª–æ–≥–∏–∫–∞ –ø–æ—Ö–æ–∂–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–∞ –±–µ–∫–µ–Ω–¥–µ.
* ‚úÖ –ê–≤—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ + –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–±–æ—Ç).
* ‚úÖ CategoryOverride (—É—á—ë—Ç —á–∞—Å—Ç—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `parse-and-create`.
* ‚úÖ –õ–æ–≥ —Ñ–∏–¥–±–µ–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π `/categories/feedback` + `log_category_feedback` (–±–æ—Ç).
* ‚úÖ –°–∫—Ä–∏–ø—Ç `normalize_categories.py` ‚Äî —á–∏—Å—Ç–∏—Ç –¥—É–±–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π.
* ‚úÖ –û—Ç—á—ë—Ç—ã summary/balance/members/shops —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –ø–æ `days`, `telegram_id` –∏ (—á–∞—Å—Ç–∏—á–Ω–æ) `user_id`.
* ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ CSV.

### 7.2. –í –ø—Ä–æ—Ü–µ—Å—Å–µ / –±–ª–∏–∂–∞–π—à–∏–µ –∑–∞–¥–∞—á–∏ üü°

* üü° –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –¥–æ–≤–µ—Å—Ç–∏ –¥–æ —É–º–∞:

  * –ø–æ–ª–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `TransactionCategoryFeedback` (–≤—Å–µ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è),
  * –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `CategoryOverride` –≤ `parse-and-create`
    (—á—ë—Ç–∫–∞—è –ª–æ–≥–∏–∫–∞ –ø–æ—Ä–æ–≥–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è `candidate_categories`).
* üü° –ü—Ä–æ–Ω–µ—Å—Ç–∏ ‚Äú—É–º–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏‚Äù –≤–æ –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:

  * –≥–æ–ª–æ—Å,
  * –∫–æ–º–∞–Ω–¥—ã `/add` –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ–∫—Å—Ç,
  * —Å–º–µ–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ—Å–ª–µ –æ—Ç—á—ë—Ç–æ–≤ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ).

### 7.3. –û—Ç–ª–æ–∂–µ–Ω–æ –Ω–∞ –ø–æ–∑–∂–µ üîú

* üîú –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –æ—Ç—á—ë—Ç–æ–≤ (–ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º, –º–∞–≥–∞–∑–∏–Ω–∞–º) + —É–¥–æ–±–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤ –±–æ—Ç–µ.
* üîú –£–ª—É—á—à–µ–Ω–∏–µ –≤—ã–≤–æ–¥–∞ –æ—Ç—á—ë—Ç–æ–≤ (—Ç–æ–ø-–∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —Å–æ–≤–µ—Ç—ã).
* üîú –ü–æ–ª–Ω—ã–π –º–æ–¥—É–ª—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π (–ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Å–æ–∑–¥–∞–Ω–∏—è ‚Üí —Ç—Ä–∏–≥–≥–µ—Ä ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è).
* üîú –†–∞–±–æ—Ç–∞ —Å —á–µ–∫–∞–º–∏ –∏ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞–º–∏ (–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ + MVP-–∏–º–ø–æ—Ä—Ç).
---

